;8255片选接IOY1
A_8255 EQU 0640H
B_8255 EQU 0642H
C_8255 EQU 0644H
CONTROL_8255 EQU 0646H

CODE SEGMENT
	ASSUME CS:CODE
START:
	MOV AX,00H;数据段基址设置为0
	MOV DS,AX
	
	MOV DX,CONTROL_8255;设置8255控制字，A输入B输出
	MOV AL,90H
	OUT DX,AL
	
	MOV AX,OFFSET MIR6;设置中断向量MIR6，中断向量6的起始地址为38H
	MOV SI,0038H
	MOV [SI],AX;低两个字节存储中断向量6的偏移地址
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX;高两个字节存储中断向量6的基地址
	
	MOV AX,OFFSET MIR7;设置中断向量MIR7，中断向量7的起始地址为3CH
	MOV SI,003CH
	MOV [SI],AX;低两个字节存储中断向量7的偏移地址
	MOV AX,CS
	MOV SI,003EH
	MOV [SI],AX;高两个字节存储中断向量7的基地址
	
	CLI;设置8259控制字
	MOV AL,11H
	OUT 20H,AL
	MOV AL,08H
	OUT 21H,AL
	MOV AL,04H
	OUT 21H,AL
	MOV AL,07H
	OUT 21H,AL
	MOV AL,2FH
	OUT 21H,AL
	STI
	
Initial:
	MOV DX,B_8255;PB端口地址
	MOV AL,0FFH;8个灯全亮
	OUT DX,AL
	JMP Initial
	
MIR6:
	MOV DX,B_8255;PB端口地址
	MOV AL,0FH;只让四个绿灯亮
	OUT DX,AL
	CALL DELAY
	IRET
	
MIR7:
	MOV DX,B_8255;PB端口地址
	MOV AL,0F0H;只让四个红灯亮
	OUT DX,AL
	CALL DELAY
	IRET
	
DELAY PROC NEAR;双重循环
	MOV CX,0FFFFH
J1:	
	MOV BX,05H
J11:
	DEC BX
	CMP BX,0000H
	JE J111
	JMP J11
J111:
	DEC CX
	CMP CX,0000H
	JNE J1
	RET
DELAY ENDP

CODE ENDS
	END START
