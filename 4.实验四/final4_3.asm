;0809片选接IOY1->从0640H开始
;0809使用通道2
;8255片选接IOY0->从0600H开始
;EOC连到MIR6

A_8255 EQU 0600H
B_8255 EQU 0602H
C_8255 EQU 0604H
CONTROL_8255 EQU 0606H

CHANNEL2 EQU 0644H

CODE SEGMENT
	ASSUME CS:CODE
START:
	MOV AX,00H;数据段基址设置为0
	MOV DS,AX
	
	MOV DX,CONTROL_8255;设置8255控制字，A输入B输出
	MOV AL,90H
	OUT DX,AL
	
	MOV AX,OFFSET MIR6;设置中断向量MIR6，中断向量6的起始地址为38H
	MOV SI,0038H
	MOV [SI],AX;低两个字节存储中断向量6的偏移地址
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX;高两个字节存储中断向量6的基地址
	
	CLI;设置8259控制字
	MOV AL,11H
	OUT 20H,AL
	MOV AL,08H
	OUT 21H,AL
	MOV AL,04H
	OUT 21H,AL
	MOV AL,07H
	OUT 21H,AL
	MOV AL,2FH
	OUT 21H,AL
	STI
	
Initial:
	CLI
	;启动通道2
    MOV DX,CHANNEL2
    OUT DX,AL
    STI
    
MAIN:
	CALL DELAY
	JMP MAIN
	
MIR6:
	MOV DX,CHANNEL2
	IN AL,DX
	
	MOV DX,B_8255;B口端口地址
    OUT DX,AL
    CALL DELAY;一定需要
    
    MOV DX,CHANNEL2
	OUT DX,AL
    
	IRET
	
	
DELAY PROC NEAR;循环
	MOV CX,0FFFFH
	LOOP $
	RET
DELAY ENDP

CODE ENDS
	END START
