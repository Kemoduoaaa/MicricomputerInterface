;8254片选接IOY0,8255片选接IOY1
;OUT1还要和MIR6连接
COUNTER0 EQU 0600H;计数器0
COUNTER1 EQU 0602H;计数器1
COUNTER2 EQU 0604H;计数器2
CONTROL8254 EQU 0606H;8254控制寄存器

A_8255 EQU 0640H;8255A口
B_8255 EQU 0642H;8255B口
C_8255 EQU 0644H;8255C口
CONTROL8255 EQU 0646H;8255控制寄存器

CODES SEGMENT
    ASSUME CS:CODES
START:
    MOV AX,00H
    MOV DS,AX
    
    MOV DX,CONTROL8255
    MOV AL,90H;A口输入，B口输出
    OUT DX,AL
    
    MOV AX,OFFSET MIR6;设置中断向量MIR6，中断向量6的起始地址为38H
	MOV SI,0038H
	MOV [SI],AX;低两个字节存储中断向量6的偏移地址
	MOV AX,CS
	MOV SI,003AH
	MOV [SI],AX;高两个字节存储中断向量6的基地址
	
	CLI;设置8259控制字
	MOV AL,11H
	OUT 20H,AL
	MOV AL,08H
	OUT 21H,AL
	MOV AL,04H
	OUT 21H,AL
	MOV AL,07H
	OUT 21H,AL
	MOV AL,2FH
	OUT 21H,AL
	STI
	
	MOV DX,CONTROL8254
	MOV AL,76H;计数器1工作方式3
	OUT DX,AL
	
	;计数初值4800H，选用时钟18，432KHZ
	MOV DX,COUNTER1
	MOV AL,00H
	OUT DX,AL
	MOV AL,48H
	OUT DX,AL
    
    
    MOV AL,00H
    MOV DX,B_8255
MAIN:
	OUT DX,AL
	JMP MAIN
	
MIR6:
	CMP AL,0FFH
	JE I1
	ROL AL,1;循环左移
	INC AL
	JMP I2
I1:
	MOV AL,00H
I2:
	IRET
    
    MOV AH,4CH
    INT 21H
CODES ENDS
    END START
